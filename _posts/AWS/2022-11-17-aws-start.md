---
title:  "[AWS] AWS 클라우드 서버 생성" 
excerpt: ""
categories:
  - AWS
tags:
  - [Cloud Server, AWS, 프리티어]
toc: true
toc_sticky: false
date: 2022-11-17
last_modified_at: 2022-11-17
---

## AWS 클라우드 서버 생성
드디어 생각만하다가 오늘에서야 회원가입하고 EC2 인스턴스를 생성했다. 😎 회사에서 클라우드 서버를 다루고 있기 때문에 쉽게 할 줄 알았는데 의외로 어려운 단어들이 많이 나와서 당황했다. 진짜 딱 인스턴스 서버하나만 달랑 생성했는데 왠지 모르게 애착이 간다. 🤣 이제 개인 프로젝트를 시작하는 첫 발걸음을 시작했다.  

## 1. 회원가입  
회원가입은 그냥 사이트에서 원하는 것만 다 기입하면 되니까 생략한다. 중간에 카드정보를 입력하는데 매사에 의심이 많던 나는 혹시라도 더미 사이트가 아닌지 확인하고 가입했다.😂 모두 기입하게 되면 결제정보로 100원이 결제되고 다시 취소된다.

처음 회원가입하게 프리티어 권한을 주는데 `12개월 일부 기능을 무료로 사용할 수 있는 것이다.` 여기서 제한적인 부분이 중요한데, 자세히 확인 하지 않았다가 1,755만원 요금폭탄을 맞은 사례도 있으니 주의하도록 하자!

[- 요금 폭탄을 맞은 사례](https://velog.io/@ysung327/AWS-1700%EB%A7%8C%EC%9B%90-%EC%9A%94%EA%B8%88%ED%8F%AD%ED%83%84-%EB%A7%9E%EC%95%98%EB%8B%A4)  
[- 프리티어 무료 사용량 범위](https://inpa.tistory.com/entry/AWS-%F0%9F%92%B0-%ED%94%84%EB%A6%AC%ED%8B%B0%EC%96%B4-%EC%9A%94%EA%B8%88-%ED%8F%AD%ED%83%84-%EB%B0%A9%EC%A7%80-%F0%9F%92%B8-%EB%AC%B4%EB%A3%8C-%EC%82%AC%EC%9A%A9%EB%9F%89-%EC%A0%95%EB%A6%AC)  
[- 클라우드 용어 정리](https://inpa.tistory.com/entry/AWS-%F0%9F%93%9A-%EC%95%84%EB%A7%88%EC%A1%B4-%EC%9B%B9-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%9A%A9%EC%96%B4-%EC%A2%85%EB%A5%98-%EC%A0%95%EB%A6%AC-EC2-EBS-RDB-S3-EBS-SES)

## 2. EC2 인스턴스 생성
AWS에는 여러 종류의 클라우드 컴퓨팅 서비스를 제공한다. 그 중에서 가장 기본이 되는 EC2 서비스를 이용 할 예정이다.  

우선 인스턴스 생성하기 전에 `우측 상단에 리전을 서울로 변경`해주도록하자. 리전이란 서버의 물리적인 위치를 의미한다. 즉 나와 가까울수록 네트워크 속도가 빠르다.  
![image](/assets/images/2022-11-17-aws-start/00.png)

### 1) EC2 인스턴스 시작
AWS콘솔 화면의 검색창에서 EC2 를 검색 후 인스턴스 시작을 누른다.  
![image](/assets/images/2022-11-17-aws-start/01.png)

### 2) 인스턴스 이름 입력
![image](/assets/images/2022-11-17-aws-start/02.png)

### 3) 애플리케이션 및 OS 이미지 선택
AMI(Amazon Machine Image)는 인스턴스를 시작하는 데 필요한 소프트웨어를 포함한 OS이다. 기본적으로 리눅스 기반이라서 큰 차이가 없을것으로 보여 선택하였다.
![image](/assets/images/2022-11-17-aws-start/03.png)

### 4) 인스턴스 유형
여러가지 옵션이 있지만 프리티어로 사용 가능한 옵션은 `한 개` 뿐이다.
![image](/assets/images/2022-11-17-aws-start/04.png)

### 5) 키 페어(로그인)
SSH 로그인시 private key로 없다면 생성하여 사용 할 것을 권장하고 있다. 간단하게 오른쪽에 `새 키 페어 생성` 사용할 수 있다. 생성 후 `다운받은 키 파일은 다시 받을 수 없으니 잘 관리 할 수 있도록 한다.`
![image](/assets/images/2022-11-17-aws-start/05.png)

### 6) 네트워크 설정
소프트 방화벽 설정으로 기본으로는 0.0.0.0(모든 대역대 허용)이므로 `새로운 그룹을 생성하여 내 IP만 허용하였다.`
![image](/assets/images/2022-11-17-aws-start/06.png)

### 7) 스토리지 구성
하드디스크 용량을 설정할 수 있다. 프리티어의 `최대 크기인 30기가바이트로 설정하였다.`
![image](/assets/images/2022-11-17-aws-start/07.jpg)

## 3. 탄력적 IP 생성 및 연결
성공적으로 생성하였다면 인스턴스 탭에서 방금 생성한 인스턴스 정보를 확인 할 수 있다. 생성된 인스턴스를 클릭하여 우측상단의 작업 버튼을 통해 쉽게 설정을 변경 할 수 있다.  

탄력적 IP란 인스턴스 기동시마다 변경되는 IP를 고정IP로 변경해주는 것을 의미한다. 프리티어에서는 한 개의 탄력적IP를 이용 할 수 있다. `단, 탄력적IP를 생성 후 EC2 인스턴스와 연결하지 않으면 과금이 발생하니 반드시 연결해주도록하자!`

```
작업 -> 보안 -> 탄력적IP
```
![image](/assets/images/2022-11-17-aws-start/08.png)

## 4. 연결
AWS에서는 EC2 인스턴스에 연결하는 4가지 방법을 제시한다. 

```
- EC2 인스턴스 연결
- Session Manager
- SSH 클라이언트
- EC2 직렬 콘솔
```

### 1) EC2 인스턴스 연결
버튼을 눌러보면 웹에서 터미널 같은 화면이 열리면서 서버와 연결된다. 

처음에는 내 아이피에서 접근하는 방화벽규칙을 열어두었으니 연결될 줄 알았지만 실패하였다. 알고보니 내 네트워크에서 바로 연결되는게 아니라 아마존에서 제공하는 특정 네트워크망을 통해서 연결이 진행되었다.

연결하려면 `접속한 리전 지역에서 연결하는 네트워크를 허용하거나 모든 네트워크를 허용해야한다.` 당연히 보안상 취약해지므로 테스트로 연결만해보고 바로 방화벽 설정을 하였다.  

[- 인스턴스 연결 허용 참고](https://kdevkr.github.io/allow-ec2-instance-connect/)

### 2) Session Manager
인스턴스에 SSM라는 소프트웨어를 설치하여 연결하는 방식으로 보인다. 사용 할 일이 없을것 같아서 패스!

### 3) SSH 클라이언트
우리가 주로 사용하는 Putty나 터미널 소프트웨어를 사용하여 연결하는 방식을 의미한다. 위에서 생성한 `탄력적 IP로 연결을 진행`하면 된다. 하지만 나는 private key를 생성했으므로 `key 파일을 이용하여 연결`해야한다. 서버에서 기본으로 생성 된 `ec2-user` 유저명으로 접속 할 수 있다. 일반 터미널로 연결하는 명령어 등도 사이트에서 상세하게 설명하므로 차근차근 진행하면 된다.

### 4) EC2 직렬 콘솔
EC2 인스턴스 연결에서 착각했던 내 네트워크망에서 직접연결 방식이 이 방식이다. `EC2 직렬 콘솔은 Default 설정이 허용하지 않으므로 사용하려면 변경`해야한다. 하지만 설정을 변경하여도 프리티어 계정에서 사용 할 수 없기도하고 보안적으로도 안전하지 않으므로 사용하지 않는 것을 권장한다.

## 5. 서버 초기 설정
SSH 클라이언트를 통해서 접속 후 기본적인 `root 패스워드 설정`과 root 접속제한 `PermitRootLogin no` 설정을 하였다. 재밌는건 `PermitRootLogin yes`를 하여도 root로 접속 시 ec2-user로 먼저 접속하라는 안내와 함께 SSH 연결이 끊긴다. 아마도 AMI의 자체적인 보안 시스템으로 보여진다.

``` 
$ sudo passwd root
> {패스워드 입력}

$ vi /etc/ssh/sshd_config
---
PermitRootLogin no
...
```
[- 서버 초기설정 참고](https://growingsaja.tistory.com/690)


## 5. 모든 연결 삭제
처음 AWS 하려고 할 때 제일 먼저 찾아본것이다. 프리티어는 부분무료이며 12개월 후에 자동으로 모든 연결이 끊기는것도 아니므로 과금정책에 대해서 몇번이고 확인했다. 나는 쫄보니깐..😢 기본적으로 `사용하지 않는 인스턴스는 중지 및 삭제`해야한다. `탄력적IP 같은 서비스는 현재 프리티어여도 EC2와 연결하지 않으면 과금이 발생한다.` 즉, 인스턴스를 중지 및 삭제 하여도 그와 연결된 서비스 DB, 탄력적IP 같은 서비스도 다 찾아서 중지 및 삭제해야한다.

아래 잘 정리된 포스트가 있으므로 확인 하도록 하자!  
[- AWS 사용하지 않을 경우 과금방지](https://brunch.co.kr/@topasvga/342)  
[- 예상비용 알람](https://brunch.co.kr/@topasvga/96)  

## 6. 참고
[- 참고](https://velog.io/@kyj311/AWS-EC2-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0)  